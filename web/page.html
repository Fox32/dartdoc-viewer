<!DOCTYPE html>
<link rel="import" href="item.html">
<link rel="import" href="category.html">
  
<element name="dartdoc-page" constructor="PageElement" extends="article"
    apply-author-styles>
  <template>
    <template instantiate="if page.currentPage is Method">
      <a on-click="page.handleLink(page.currentPage.type)">
        {{page.currentPage.type.simpleType}}
      </a>
    </template>

    <h1>{{title}}</h1>

    <!-- Parameters -->
    <template instantiate="if page.currentPage is Method">
      <p>(
        <template iterate="parameter in required">
          <a on-click="page.handleLink(parameter.type)">
            {{parameter.type.simpleType}}
          </a>{{parameter.decoratedName}}
          <template if="parameter != required.last || !optional.isEmpty">
            ,&nbsp;
          </template>
        </template>
        <template if="!optional.isEmpty">
          {{optional.first.isNamed ? '{' : '['}}
          <template iterate="parameter in optional">
            <a on-click="page.handleLink(parameter.type)">
              {{parameter.type.simpleType}}
            </a>{{parameter.decoratedName}}
            <template if="parameter != optional.last">
              ,&nbsp;
            </template>
          </template>
          {{optional.first.isNamed ? '}' : ']'}}
        </template>
      )</p>
    </template>
    
    <!-- Inheritance -->
    <template instantiate="if page.currentPage is Class">
      <p>
        <template if="!interfaces.isEmpty">
          Implements:&nbsp;
          <template iterate="item in interfaces">
            <a on-click="page.handleLink(item)">
              {{item.simpleType}}
            </a>
            <template if="item != interfaces.last">
              ,&nbsp;
            </template>
            <template instantiate="if item == interfaces.last">
              <br/>
            </template>
          </template>
        </template>
        Extends:&nbsp;
        <a on-click="page.handleLink(superClass)">
          {{superClass.simpleType}}
        </a>
      </p>
    </template>

    <section class="description">{{insert()}}</section>

    <template instantiate="if page.currentPage != null">
      <template iterate="item in page.currentPage.content">
        <template if="item is Item">
          <dartdoc-item item="{{item}}"></dartdoc-item>
        </template>
        <template if="item is Category">
          <dartdoc-category category="{{item}}" class="category">
          </dartdoc-category>
        </template>
      </template>
    </template> 
  </template>
  
  <script type="application/dart">
    import 'dart:html';
    import 'package:web_ui/web_ui.dart';
    import 'package:dartdoc_viewer/item.dart';
    import 'app.dart' as app;
    
    /**
     * An HTML representation of a page
     */
    class PageElement extends WebComponent {
      
      app.Viewer page = app.viewer;
      
      List<LinkableType> get optional => 
        page.currentPage.parameters.where((item) => item.isOptional).toList();
        
      List<LinkableType> get required => 
        page.currentPage.parameters.where((item) => !item.isOptional).toList();
      
      List<LinkableType> get interfaces => page.currentPage.implements;
      
      LinkableType get superClass => page.currentPage.superClass;
      
      String get title => page.currentPage.name;
      
      insert() {
        if (page.currentPage.comment != '' && 
            page.currentPage.comment != null) {
          Element el = getShadowRoot('dartdoc-page').query('.description');
          el.children.clear();
          el.children.add(new Element.html(page.currentPage.comment));
        }
      }
    }
  </script>
</element>